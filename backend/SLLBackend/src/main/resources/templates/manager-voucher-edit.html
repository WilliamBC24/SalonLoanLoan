<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8" />
    <title th:text="#{manager-voucher-edit.pageTitle}">Manager - Edit Voucher | Salon Loan Loan</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Global staff layout styles -->
    <link rel="stylesheet" th:href="@{/css/styles.css}" />

    <style>
        /* ===== PAGE STRUCTURE ===== */
        .voucher-edit-page {
            padding: 2.5rem 0 3rem;
            background: var(--bg-light);
            min-height: 100vh;
        }

        .voucher-edit-layout-inner {
            max-width: 70vw;
            width: 100%;
            margin: 1.5rem auto;
        }

        .voucher-edit-card {
            background: #ffffff;
            padding: 2.3rem 2.6rem;
            border-radius: var(--radius-lg);
            border: 1px solid #e5e7eb;
            box-shadow: var(--shadow-soft);
        }

        /* ===== HEADER ===== */
        .voucher-edit-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.6rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .voucher-edit-title-block {
            text-align: left;
        }

        .voucher-edit-title-block .section-kicker {
            margin-bottom: 0.25rem;
        }

        .voucher-edit-title-block h2 {
            margin: 0;
        }

        .voucher-edit-actions {
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .back-link-pill {
            font-size: 0.8rem;
            border-radius: 999px;
            border: 1px solid #d0d0d0;
            padding: 0.4rem 0.9rem;
            background: #ffffff;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            text-decoration: none;
            color: var(--text-main);
        }

        .back-link-pill span.icon {
            font-size: 1.05rem;
            line-height: 1;
        }

        .back-link-pill:hover {
            background: #f4f4f4;
        }

        /* ===== ALERTS ===== */
        .alert {
            padding: 0.7rem 0.9rem;
            margin-bottom: 1rem;
            border-radius: 12px;
            font-size: 0.9rem;
        }

        .alert-error {
            background: #fef2f2;
            color: #b91c1c;
            border: 1px solid #fecaca;
        }

        /* ===== FORM LAYOUT ===== */
        .voucher-form-grid {
            display: grid;
            gap: 1.3rem 1.4rem;
            grid-template-columns: repeat(2, minmax(0,1fr));
        }

        @media (max-width: 800px) {
            .voucher-edit-layout-inner {
                max-width: 90vw;
            }
            .voucher-form-grid {
                grid-template-columns: minmax(0,1fr);
            }
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }

        .form-label {
            font-size: 0.85rem;
            font-weight: 600;
            color: #374151;
        }

        .form-label.required::after {
            content: " *";
            color: #dc3545;
        }

        .form-control {
            width: 100%;
            padding: 0.65rem 0.8rem;
            border-radius: 10px;
            border: 1px solid #d1d5db;
            font-size: 0.9rem;
            box-sizing: border-box;
            background: #ffffff;
        }

        .form-control:disabled {
            background-color: #f3f4f6;
            cursor: not-allowed;
        }

        .form-control.invalid {
            border-color: #dc3545;
        }

        textarea.form-control {
            min-height: 110px;
            resize: vertical;
        }

        .field-error {
            color: #dc3545;
            font-size: 0.8rem;
            display: none;
        }

        /* ===== BUTTONS ===== */
        .button-group {
            margin-top: 2rem;
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.55rem 1.4rem;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            text-decoration: none;
        }

        .btn-primary {
            background: #2563eb;
            color: #ffffff;
            box-shadow: 0 8px 18px rgba(37,99,235,0.24);
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-secondary {
            background: #ffffff;
            color: #111827;
            border: 1px solid #d1d5db;
        }

        .btn-secondary:hover {
            background: #f3f4f6;
        }
    </style>
</head>
<body class="staff-layout">

<!-- Sidebar -->
<div th:replace="~{fragments/staff-sidebar :: staff-site-header}"></div>

<!-- MAIN CONTENT -->
<main class="staff-main voucher-edit-page">
    <div class="voucher-edit-layout-inner">
        <section class="voucher-edit-card">

            <header class="voucher-edit-header">
                <div class="voucher-edit-title-block section-heading">
                    <p class="section-kicker" th:text="#{manager-voucher.kicker}">Voucher Management</p>
                    <h2 th:text="#{manager-voucher-edit.title}">Edit Voucher</h2>
                </div>
                <div class="voucher-edit-actions">
                    <a href="/manager/voucher/list" class="back-link-pill">
                        <span class="icon">←</span>
                        <span th:text="#{common.backToList}">Back to list</span>
                    </a>
                </div>
            </header>

            <div th:if="${errorMessage}" class="alert alert-error" th:text="${errorMessage}"></div>

            <form id="voucherForm"
                  method="post"
                  th:action="@{/manager/voucher/edit/{id}(id=${voucher.id})}">

                <div class="voucher-form-grid">

                    <div class="form-group">
                        <label for="voucherName" class="form-label required"
                               th:text="#{manager-voucher.field.name}">Voucher Name</label>
                        <input type="text"
                               id="voucherName"
                               name="voucherName"
                               class="form-control"
                               th:value="${voucher.voucherName}"
                               required>
                        <div class="field-error" id="voucherNameError"
                             th:text="#{manager-voucher.error.nameRequired}">
                            Voucher name is required.
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="voucherCode" class="form-label required"
                               th:text="#{manager-voucher.field.code}">Voucher Code</label>
                        <input type="text"
                               id="voucherCode"
                               name="voucherCode"
                               class="form-control"
                               th:value="${voucher.voucherCode}"
                               required>
                        <div class="field-error" id="voucherCodeError"
                             th:text="#{manager-voucher.error.codeRequired}">
                            Voucher code is required.
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="discountType" class="form-label required"
                               th:text="#{manager-voucher.field.discountType}">Discount Type</label>
                        <select id="discountType" name="discountType" class="form-control" required>
                            <option value="" th:text="#{common.select}">Select</option>
                            <option value="AMOUNT"
                                    th:selected="${voucher.discountType.toString() == 'AMOUNT'}"
                                    th:text="#{common.amount}">
                                Amount
                            </option>
                            <option value="PERCENTAGE"
                                    th:selected="${voucher.discountType.toString() == 'PERCENTAGE'}"
                                    th:text="#{common.percentage}">
                                Percentage
                            </option>
                        </select>
                        <div class="field-error" id="discountTypeError"
                             th:text="#{manager-voucher.error.discountType}">
                            Please select a discount type.
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="discountAmount" class="form-label required"
                               th:text="#{manager-voucher.field.discountAmount}">Discount Amount</label>
                        <input type="number"
                               id="discountAmount"
                               name="discountAmount"
                               class="form-control"
                               th:value="${voucher.discountAmount}"
                               min="1"
                               required>
                        <div class="field-error" id="discountAmountError"
                             th:text="#{manager-voucher.error.discountAmount}">
                            Discount amount must be greater than 0.
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="effectiveFrom" class="form-label required"
                               th:text="#{manager-voucher.field.effectiveFrom}">Effective From</label>
                        <input type="datetime-local"
                               id="effectiveFrom"
                               name="effectiveFrom"
                               class="form-control"
                               th:value="${voucher.effectiveFrom != null ? #temporals.format(voucher.effectiveFrom, 'yyyy-MM-dd''T''HH:mm') : ''}"
                               required>
                        <div class="field-error" id="effectiveFromError"
                             th:text="#{manager-voucher.error.effectiveFrom}">
                            Effective from date is required.
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="effectiveTo" class="form-label required"
                               th:text="#{manager-voucher.field.effectiveTo}">Effective To</label>
                        <input type="datetime-local"
                               id="effectiveTo"
                               name="effectiveTo"
                               class="form-control"
                               th:value="${voucher.effectiveTo != null ? #temporals.format(voucher.effectiveTo, 'yyyy-MM-dd''T''HH:mm') : ''}"
                               required>
                        <div class="field-error" id="effectiveToError"
                             th:text="#{manager-voucher.error.effectiveTo}">
                            Effective to date must be after effective from date.
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="maxUsage" class="form-label required"
                               th:text="#{manager-voucher.field.maxUsage}">Max Usage</label>
                        <input type="number"
                               id="maxUsage"
                               name="maxUsage"
                               class="form-control"
                               th:value="${voucher.maxUsage}"
                               min="1"
                               required>
                        <div class="field-error" id="maxUsageError"
                             th:text="#{manager-voucher.error.maxUsage}">
                            Max usage must be greater than 0.
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label"
                               th:text="#{manager-voucher.field.usedCount}">
                            Used Count
                        </label>
                        <input type="number"
                               class="form-control"
                               th:value="${voucher.usedCount}"
                               disabled>
                    </div>

                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="voucherDescription" class="form-label required"
                               th:text="#{manager-voucher.field.description}">
                            Voucher Description
                        </label>
                        <textarea id="voucherDescription"
                                  name="voucherDescription"
                                  class="form-control"
                                  required
                                  th:text="${voucher.voucherDescription}"></textarea>
                        <div class="field-error" id="voucherDescriptionError">
                            Voucher description is required.
                        </div>
                    </div>

                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="voucherStatusId" class="form-label required"
                               th:text="#{manager-voucher.field.status}">
                            Voucher Status
                        </label>
                        <select id="voucherStatusId" name="voucherStatusId"
                                class="form-control" required>
                            <option value="" th:text="#{common.select}">Select</option>
                            <option th:each="status : ${statuses}"
                                    th:value="${status.id}"
                                    th:text="${status.name}"
                                    th:selected="${voucher.voucherStatus.id == status.id}">
                                Status
                            </option>
                        </select>
                        <div class="field-error" id="voucherStatusIdError">
                            Please select a voucher status.
                        </div>
                    </div>

                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-primary">
                        ✓ <span th:text="#{manager-voucher-edit.submit}">Update Voucher</span>
                    </button>
                    <a href="/manager/voucher/list" class="btn btn-secondary">
                        ✕ <span th:text="#{common.cancel}">Cancel</span>
                    </a>
                </div>

            </form>
        </section>
    </div>

    <script>
        const msgFixErrors = '[[#{common.fixFormErrors}]]';

        document.getElementById('voucherForm').addEventListener('submit', function(event) {
            let isValid = true;

            function validateRequired(id, errorId) {
                const el = document.getElementById(id);
                const err = document.getElementById(errorId);
                if (!el.value.trim()) {
                    el.classList.add('invalid');
                    err.style.display = 'block';
                    isValid = false;
                } else {
                    el.classList.remove('invalid');
                    err.style.display = 'none';
                }
            }

            validateRequired('voucherName', 'voucherNameError');
            validateRequired('voucherDescription', 'voucherDescriptionError');
            validateRequired('voucherCode', 'voucherCodeError');
            validateRequired('discountType', 'discountTypeError');
            validateRequired('effectiveFrom', 'effectiveFromError');
            validateRequired('effectiveTo', 'effectiveToError');
            validateRequired('voucherStatusId', 'voucherStatusIdError');

            const discountAmount = document.getElementById('discountAmount');
            const maxUsage = document.getElementById('maxUsage');

            if (!discountAmount.value || parseInt(discountAmount.value) < 1) {
                discountAmount.classList.add('invalid');
                document.getElementById('discountAmountError').style.display = 'block';
                isValid = false;
            }

            if (!maxUsage.value || parseInt(maxUsage.value) < 1) {
                maxUsage.classList.add('invalid');
                document.getElementById('maxUsageError').style.display = 'block';
                isValid = false;
            }

            const effectiveFrom = document.getElementById('effectiveFrom').value;
            const effectiveTo = document.getElementById('effectiveTo').value;
            if (effectiveFrom && effectiveTo && new Date(effectiveTo) <= new Date(effectiveFrom)) {
                document.getElementById('effectiveTo').classList.add('invalid');
                document.getElementById('effectiveToError').style.display = 'block';
                isValid = false;
            }

            if (!isValid) {
                event.preventDefault();
                alert(msgFixErrors);
            }
        });
    </script>
</main>

</body>
</html>
