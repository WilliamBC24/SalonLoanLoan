<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Staff - Edit Promotion</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            max-width: 800px;
        }
        h1 {
            color: #333;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        .form-group .error {
            color: #dc3545;
            font-size: 0.875em;
            margin-top: 5px;
            display: none;
        }
        .form-group input.invalid,
        .form-group select.invalid,
        .form-group textarea.invalid {
            border-color: #dc3545;
        }
        .form-group input:disabled {
            background-color: #e9ecef;
            cursor: not-allowed;
        }
        .button-group {
            margin-top: 30px;
            display: flex;
            gap: 10px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .btn-primary {
            background: #007bff;
            color: white;
        }
        .btn-primary:hover {
            background: #0056b3;
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #545b62;
        }
        .alert {
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .required::after {
            content: " *";
            color: #dc3545;
        }
    </style>
</head>
<body>
    <h1>Edit Promotion</h1>

    <!-- Error Messages -->
    <div th:if="${errorMessage}" class="alert alert-error" th:text="${errorMessage}"></div>

    <form id="promotionForm" method="post" th:action="@{/staff/promotion/edit/{id}(id=${promotion.id})}">
        <div class="form-group">
            <label for="promotionName" class="required">Promotion Name</label>
            <input type="text" id="promotionName" name="promotionName" th:value="${promotion.promotionName}" required>
            <div class="error" id="promotionNameError">Promotion name is required.</div>
        </div>

        <div class="form-group">
            <label for="promotionDescription">Promotion Description</label>
            <textarea id="promotionDescription" name="promotionDescription" th:text="${promotion.promotionDescription}"></textarea>
        </div>

        <div class="form-group">
            <label for="discountType" class="required">Discount Type</label>
            <select id="discountType" name="discountType" required>
                <option value="">Select Discount Type</option>
                <option value="AMOUNT" th:selected="${promotion.discountType.toString() == 'AMOUNT'}">Amount</option>
                <option value="PERCENTAGE" th:selected="${promotion.discountType.toString() == 'PERCENTAGE'}">Percentage</option>
            </select>
            <div class="error" id="discountTypeError">Please select a discount type.</div>
        </div>

        <div class="form-group">
            <label for="discountAmount" class="required">Discount Amount</label>
            <input type="number" id="discountAmount" name="discountAmount" th:value="${promotion.discountAmount}" min="1" required>
            <div class="error" id="discountAmountError">Discount amount must be greater than 0.</div>
        </div>

        <div class="form-group">
            <label for="effectiveFrom" class="required">Effective From</label>
            <input type="datetime-local" id="effectiveFrom" name="effectiveFrom" 
                   th:value="${#temporals.format(promotion.effectiveFrom, 'yyyy-MM-dd' + 'T' + 'HH:mm')}" required>
            <div class="error" id="effectiveFromError">Effective from date is required.</div>
        </div>

        <div class="form-group">
            <label for="effectiveTo" class="required">Effective To</label>
            <input type="datetime-local" id="effectiveTo" name="effectiveTo" 
                   th:value="${#temporals.format(promotion.effectiveTo, 'yyyy-MM-dd' + 'T' + 'HH:mm')}" required>
            <div class="error" id="effectiveToError">Effective to date is required and must be after effective from date.</div>
        </div>

        <div class="form-group">
            <label for="promotionStatusId" class="required">Promotion Status</label>
            <select id="promotionStatusId" name="promotionStatusId" required>
                <option value="">Select Status</option>
                <option th:each="status : ${statuses}" 
                        th:value="${status.id}" 
                        th:text="${status.name}"
                        th:selected="${promotion.promotionStatus.id == status.id}">
                    Status
                </option>
            </select>
            <div class="error" id="promotionStatusIdError">Please select a promotion status.</div>
        </div>

        <div class="button-group">
            <button type="submit" class="btn btn-primary">Update Promotion</button>
            <button type="button" class="btn btn-secondary" onclick="window.location.href='/staff/promotion/list'">Cancel</button>
        </div>
    </form>

    <script>
        document.getElementById('promotionForm').addEventListener('submit', function(event) {
            let isValid = true;

            // Validate promotion name
            const promotionName = document.getElementById('promotionName');
            const promotionNameError = document.getElementById('promotionNameError');
            if (!promotionName.value.trim()) {
                promotionName.classList.add('invalid');
                promotionNameError.style.display = 'block';
                isValid = false;
            } else {
                promotionName.classList.remove('invalid');
                promotionNameError.style.display = 'none';
            }

            // Validate promotion description
            const promotionDescription = document.getElementById('promotionDescription');
            const promotionDescriptionError = document.getElementById('promotionDescriptionError');
            if (!promotionDescription.value.trim()) {
                promotionDescription.classList.add('invalid');
                promotionDescriptionError.style.display = 'block';
                isValid = false;
            } else {
                promotionDescription.classList.remove('invalid');
                promotionDescriptionError.style.display = 'none';
            }

            // Validate promotion code
            const promotionCode = document.getElementById('promotionCode');
            const promotionCodeError = document.getElementById('promotionCodeError');
            if (!promotionCode.value.trim()) {
                promotionCode.classList.add('invalid');
                promotionCodeError.style.display = 'block';
                isValid = false;
            } else {
                promotionCode.classList.remove('invalid');
                promotionCodeError.style.display = 'none';
            }

            // Validate discount type
            const discountType = document.getElementById('discountType');
            const discountTypeError = document.getElementById('discountTypeError');
            if (!discountType.value) {
                discountType.classList.add('invalid');
                discountTypeError.style.display = 'block';
                isValid = false;
            } else {
                discountType.classList.remove('invalid');
                discountTypeError.style.display = 'none';
            }

            // Validate discount amount
            const discountAmount = document.getElementById('discountAmount');
            const discountAmountError = document.getElementById('discountAmountError');
            if (!discountAmount.value || parseInt(discountAmount.value) < 1) {
                discountAmount.classList.add('invalid');
                discountAmountError.style.display = 'block';
                isValid = false;
            } else {
                discountAmount.classList.remove('invalid');
                discountAmountError.style.display = 'none';
            }

            // Validate effective from
            const effectiveFrom = document.getElementById('effectiveFrom');
            const effectiveFromError = document.getElementById('effectiveFromError');
            if (!effectiveFrom.value) {
                effectiveFrom.classList.add('invalid');
                effectiveFromError.style.display = 'block';
                isValid = false;
            } else {
                effectiveFrom.classList.remove('invalid');
                effectiveFromError.style.display = 'none';
            }

            // Validate effective to
            const effectiveTo = document.getElementById('effectiveTo');
            const effectiveToError = document.getElementById('effectiveToError');
            if (!effectiveTo.value) {
                effectiveTo.classList.add('invalid');
                effectiveToError.style.display = 'block';
                isValid = false;
            } else if (effectiveFrom.value && effectiveTo.value && new Date(effectiveTo.value) <= new Date(effectiveFrom.value)) {
                effectiveTo.classList.add('invalid');
                effectiveToError.style.display = 'block';
                isValid = false;
            } else {
                effectiveTo.classList.remove('invalid');
                effectiveToError.style.display = 'none';
            }

            // Validate max usage
            const maxUsage_OLD = document.getElementById('maxUsage_OLD');
            const maxUsage_OLDError = document.getElementById('maxUsage_OLDError');
            if (!maxUsage_OLD.value || parseInt(maxUsage_OLD.value) < 1) {
                maxUsage_OLD.classList.add('invalid');
                maxUsage_OLDError.style.display = 'block';
                isValid = false;
            } else {
                maxUsage_OLD.classList.remove('invalid');
                maxUsage_OLDError.style.display = 'none';
            }

            // Validate promotion status
            const promotionStatusId = document.getElementById('promotionStatusId');
            const promotionStatusIdError = document.getElementById('promotionStatusIdError');
            if (!promotionStatusId.value) {
                promotionStatusId.classList.add('invalid');
                promotionStatusIdError.style.display = 'block';
                isValid = false;
            } else {
                promotionStatusId.classList.remove('invalid');
                promotionStatusIdError.style.display = 'none';
            }

            if (!isValid) {
                event.preventDefault();
                alert('Please correct the errors in the form before submitting.');
            }
        });

        // Real-time validation on input
        document.getElementById('promotionName').addEventListener('input', function() {
            if (this.value.trim()) {
                this.classList.remove('invalid');
                document.getElementById('promotionNameError').style.display = 'none';
            }
        });

        document.getElementById('promotionDescription').addEventListener('input', function() {
            if (this.value.trim()) {
                this.classList.remove('invalid');
                document.getElementById('promotionDescriptionError').style.display = 'none';
            }
        });

        document.getElementById('promotionCode').addEventListener('input', function() {
            if (this.value.trim()) {
                this.classList.remove('invalid');
                document.getElementById('promotionCodeError').style.display = 'none';
            }
        });

        document.getElementById('discountType').addEventListener('change', function() {
            if (this.value) {
                this.classList.remove('invalid');
                document.getElementById('discountTypeError').style.display = 'none';
            }
        });

        document.getElementById('discountAmount').addEventListener('input', function() {
            if (this.value && parseInt(this.value) >= 1) {
                this.classList.remove('invalid');
                document.getElementById('discountAmountError').style.display = 'none';
            }
        });

        document.getElementById('effectiveFrom').addEventListener('change', function() {
            if (this.value) {
                this.classList.remove('invalid');
                document.getElementById('effectiveFromError').style.display = 'none';
            }
        });

        document.getElementById('effectiveTo').addEventListener('change', function() {
            const effectiveFrom = document.getElementById('effectiveFrom').value;
            if (this.value && (!effectiveFrom || new Date(this.value) > new Date(effectiveFrom))) {
                this.classList.remove('invalid');
                document.getElementById('effectiveToError').style.display = 'none';
            }
        });

        document.getElementById('maxUsage_OLD').addEventListener('input', function() {
            if (this.value && parseInt(this.value) >= 1) {
                this.classList.remove('invalid');
                document.getElementById('maxUsage_OLDError').style.display = 'none';
            }
        });

        document.getElementById('promotionStatusId').addEventListener('change', function() {
            if (this.value) {
                this.classList.remove('invalid');
                document.getElementById('promotionStatusIdError').style.display = 'none';
            }
        });
    </script>
</body>
</html>
