<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:lang="${#locale.language}">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title th:text="#{staff.vouchers.create.page.title} + ' | ' + #{app.name}">Staff - Create Voucher | Salon Loan Loan</title>
    
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <!-- Your CSS -->
    <link rel="stylesheet" th:href="@{/css/staff-voucher-create.css}">
    <!-- Staff Sidebar CSS -->
    <link rel="stylesheet" th:href="@{/css/staff-sidebar.css}">
</head>
<body>
    <div class="d-flex">
        <!-- Sidebar Fragment -->
        <div th:replace="fragments/staff-sidebar :: staff-sidebar"></div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header Fragment -->
            <div th:replace="fragments/staff-sidebar :: staff-header"></div>

            <!-- Content -->
            <div class="content">
                <h1 class="page-title" th:text="#{staff.vouchers.create.title}">Create New Voucher</h1>

                <!-- Error Messages -->
                <div th:if="${errorMessage}" class="alert alert-error" th:text="${errorMessage}"></div>

                <div class="form-container">
                    <form id="voucherForm" method="post" th:action="@{/staff/voucher/create}">
                        <div class="form-group">
                            <label for="voucherName" class="required" th:text="#{staff.vouchers.form.name}">Voucher Name</label>
                            <input type="text" id="voucherName" name="voucherName" required>
                            <div class="error" id="voucherNameError" th:text="#{staff.vouchers.form.name.error.required}">Voucher name is required.</div>
                        </div>

                        <div class="form-group">
                            <label for="voucherDescription" class="required" th:text="#{staff.vouchers.form.description}">Voucher Description</label>
                            <textarea id="voucherDescription" name="voucherDescription" required></textarea>
                            <div class="error" id="voucherDescriptionError" th:text="#{staff.vouchers.form.description.error.required}">Voucher description is required.</div>
                        </div>

                        <div class="form-group">
                            <label for="voucherCode" class="required" th:text="#{staff.vouchers.form.code}">Voucher Code</label>
                            <input type="text" id="voucherCode" name="voucherCode" required>
                            <div class="error" id="voucherCodeError" th:text="#{staff.vouchers.form.code.error.required}">Voucher code is required.</div>
                        </div>

                        <div class="form-group">
                            <label for="discountType" class="required" th:text="#{staff.vouchers.form.discount.type}">Discount Type</label>
                            <select id="discountType" name="discountType" required>
                                <option value="" th:text="#{staff.vouchers.form.discount.type.select}">Select Discount Type</option>
                                <option value="AMOUNT" th:text="#{staff.vouchers.filter.discount.type.amount}">Amount</option>
                                <option value="PERCENTAGE" th:text="#{staff.vouchers.filter.discount.type.percentage}">Percentage</option>
                            </select>
                            <div class="error" id="discountTypeError" th:text="#{staff.vouchers.form.discount.type.error.required}">Please select a discount type.</div>
                        </div>

                        <div class="form-group">
                            <label for="discountAmount" class="required" th:text="#{staff.vouchers.form.discount.amount}">Discount Amount</label>
                            <input type="number" id="discountAmount" name="discountAmount" min="1" required>
                            <div class="error" id="discountAmountError" th:text="#{staff.vouchers.form.discount.amount.error.required}">Discount amount must be greater than 0.</div>
                        </div>

                        <div class="form-group">
                            <label for="effectiveFrom" class="required" th:text="#{staff.vouchers.form.effective.from}">Effective From</label>
                            <input type="datetime-local" id="effectiveFrom" name="effectiveFrom" required>
                            <div class="error" id="effectiveFromError" th:text="#{staff.vouchers.form.effective.from.error.required}">Effective from date is required.</div>
                        </div>

                        <div class="form-group">
                            <label for="effectiveTo" class="required" th:text="#{staff.vouchers.form.effective.to}">Effective To</label>
                            <input type="datetime-local" id="effectiveTo" name="effectiveTo" required>
                            <div class="error" id="effectiveToError" th:text="#{staff.vouchers.form.effective.to.error.required}">Effective to date is required and must be after effective from date.</div>
                        </div>

                        <div class="form-group">
                            <label for="maxUsage" class="required" th:text="#{staff.vouchers.form.max.usage}">Max Usage</label>
                            <input type="number" id="maxUsage" name="maxUsage" min="1" required>
                            <div class="error" id="maxUsageError" th:text="#{staff.vouchers.form.max.usage.error.required}">Max usage must be greater than 0.</div>
                        </div>

                        <div class="form-group">
                            <label for="voucherStatusId" class="required" th:text="#{staff.vouchers.form.status}">Voucher Status</label>
                            <select id="voucherStatusId" name="voucherStatusId" required>
                                <option value="" th:text="#{staff.vouchers.form.status.select}">Select Status</option>
                                <option th:each="status : ${statuses ?: {}}" th:value="${status.id}" th:text="${status.name}">Status</option>
                            </select>
                            <div class="error" id="voucherStatusIdError" th:text="#{staff.vouchers.form.status.error.required}">Please select a voucher status.</div>
                        </div>

                        <div class="button-group">
                            <button type="submit" class="btn btn-primary" th:text="#{btn.create}">Create Voucher</button>
                            <button type="button" class="btn btn-secondary" onclick="window.location.href='/staff/voucher/list'" th:text="#{btn.cancel}">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Staff Scripts Fragment -->
    <div th:replace="fragments/staff-sidebar :: staff-scripts"></div>

    <script>
        document.getElementById('voucherForm').addEventListener('submit', function(event) {
            let isValid = true;

            // Validate voucher name
            const voucherName = document.getElementById('voucherName');
            const voucherNameError = document.getElementById('voucherNameError');
            if (!voucherName.value.trim()) {
                voucherName.classList.add('invalid');
                voucherNameError.style.display = 'block';
                isValid = false;
            } else {
                voucherName.classList.remove('invalid');
                voucherNameError.style.display = 'none';
            }

            // Validate voucher description
            const voucherDescription = document.getElementById('voucherDescription');
            const voucherDescriptionError = document.getElementById('voucherDescriptionError');
            if (!voucherDescription.value.trim()) {
                voucherDescription.classList.add('invalid');
                voucherDescriptionError.style.display = 'block';
                isValid = false;
            } else {
                voucherDescription.classList.remove('invalid');
                voucherDescriptionError.style.display = 'none';
            }

            // Validate voucher code
            const voucherCode = document.getElementById('voucherCode');
            const voucherCodeError = document.getElementById('voucherCodeError');
            if (!voucherCode.value.trim()) {
                voucherCode.classList.add('invalid');
                voucherCodeError.style.display = 'block';
                isValid = false;
            } else {
                voucherCode.classList.remove('invalid');
                voucherCodeError.style.display = 'none';
            }

            // Validate discount type
            const discountType = document.getElementById('discountType');
            const discountTypeError = document.getElementById('discountTypeError');
            if (!discountType.value) {
                discountType.classList.add('invalid');
                discountTypeError.style.display = 'block';
                isValid = false;
            } else {
                discountType.classList.remove('invalid');
                discountTypeError.style.display = 'none';
            }

            // Validate discount amount
            const discountAmount = document.getElementById('discountAmount');
            const discountAmountError = document.getElementById('discountAmountError');
            if (!discountAmount.value || parseInt(discountAmount.value) < 1) {
                discountAmount.classList.add('invalid');
                discountAmountError.style.display = 'block';
                isValid = false;
            } else {
                discountAmount.classList.remove('invalid');
                discountAmountError.style.display = 'none';
            }

            // Validate effective from
            const effectiveFrom = document.getElementById('effectiveFrom');
            const effectiveFromError = document.getElementById('effectiveFromError');
            if (!effectiveFrom.value) {
                effectiveFrom.classList.add('invalid');
                effectiveFromError.style.display = 'block';
                isValid = false;
            } else {
                effectiveFrom.classList.remove('invalid');
                effectiveFromError.style.display = 'none';
            }

            // Validate effective to
            const effectiveTo = document.getElementById('effectiveTo');
            const effectiveToError = document.getElementById('effectiveToError');
            if (!effectiveTo.value) {
                effectiveTo.classList.add('invalid');
                effectiveToError.style.display = 'block';
                isValid = false;
            } else if (effectiveFrom.value && effectiveTo.value && new Date(effectiveTo.value) <= new Date(effectiveFrom.value)) {
                effectiveTo.classList.add('invalid');
                effectiveToError.style.display = 'block';
                isValid = false;
            } else {
                effectiveTo.classList.remove('invalid');
                effectiveToError.style.display = 'none';
            }

            // Validate max usage
            const maxUsage = document.getElementById('maxUsage');
            const maxUsageError = document.getElementById('maxUsageError');
            if (!maxUsage.value || parseInt(maxUsage.value) < 1) {
                maxUsage.classList.add('invalid');
                maxUsageError.style.display = 'block';
                isValid = false;
            } else {
                maxUsage.classList.remove('invalid');
                maxUsageError.style.display = 'none';
            }

            // Validate voucher status
            const voucherStatusId = document.getElementById('voucherStatusId');
            const voucherStatusIdError = document.getElementById('voucherStatusIdError');
            if (!voucherStatusId.value) {
                voucherStatusId.classList.add('invalid');
                voucherStatusIdError.style.display = 'block';
                isValid = false;
            } else {
                voucherStatusId.classList.remove('invalid');
                voucherStatusIdError.style.display = 'none';
            }

            if (!isValid) {
                event.preventDefault();
                alert(/*[[#{form.validation.error}]]*/ 'Please correct the errors in the form before submitting.');
            }
        });

        // Real-time validation on input
        document.getElementById('voucherName').addEventListener('input', function() {
            if (this.value.trim()) {
                this.classList.remove('invalid');
                document.getElementById('voucherNameError').style.display = 'none';
            }
        });

        document.getElementById('voucherDescription').addEventListener('input', function() {
            if (this.value.trim()) {
                this.classList.remove('invalid');
                document.getElementById('voucherDescriptionError').style.display = 'none';
            }
        });

        document.getElementById('voucherCode').addEventListener('input', function() {
            if (this.value.trim()) {
                this.classList.remove('invalid');
                document.getElementById('voucherCodeError').style.display = 'none';
            }
        });

        document.getElementById('discountType').addEventListener('change', function() {
            if (this.value) {
                this.classList.remove('invalid');
                document.getElementById('discountTypeError').style.display = 'none';
            }
        });

        document.getElementById('discountAmount').addEventListener('input', function() {
            if (this.value && parseInt(this.value) >= 1) {
                this.classList.remove('invalid');
                document.getElementById('discountAmountError').style.display = 'none';
            }
        });

        document.getElementById('effectiveFrom').addEventListener('change', function() {
            if (this.value) {
                this.classList.remove('invalid');
                document.getElementById('effectiveFromError').style.display = 'none';
            }
        });

        document.getElementById('effectiveTo').addEventListener('change', function() {
            const effectiveFrom = document.getElementById('effectiveFrom').value;
            if (this.value && (!effectiveFrom || new Date(this.value) > new Date(effectiveFrom))) {
                this.classList.remove('invalid');
                document.getElementById('effectiveToError').style.display = 'none';
            }
        });

        document.getElementById('maxUsage').addEventListener('input', function() {
            if (this.value && parseInt(this.value) >= 1) {
                this.classList.remove('invalid');
                document.getElementById('maxUsageError').style.display = 'none';
            }
        });

        document.getElementById('voucherStatusId').addEventListener('change', function() {
            if (this.value) {
                this.classList.remove('invalid');
                document.getElementById('voucherStatusIdError').style.display = 'none';
            }
        });
    </script>
</body>
</html>
