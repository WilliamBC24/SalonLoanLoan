<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:lang="${#locale.language}">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title th:text="#{staff.providers.edit.page.title} + ' | ' + #{app.name}">Staff - Edit Provider | Salon Loan Loan</title>
    
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" />
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
    <!-- Your CSS -->
    <link rel="stylesheet" th:href="@{/css/staff-provider-edit.css}">
    <!-- Staff Sidebar CSS -->
    <link rel="stylesheet" th:href="@{/css/staff-sidebar.css}">
    <style>
        .form-label.required::after {
            content: " *";
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="d-flex">
        <!-- Sidebar Fragment -->
        <div th:replace="fragments/staff-sidebar :: staff-sidebar"></div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header Fragment -->
            <div th:replace="fragments/staff-sidebar :: staff-header"></div>

            <!-- Content -->
            <div class="content">
                <h1 class="page-title" th:text="#{staff.providers.edit.title}">Edit Provider</h1>
                <p class="info-text" th:text="#{staff.providers.edit.id} + ': ' + ${supplier.id}">Provider ID: 1</p>

                <!-- Error Messages -->
                <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="fa-solid fa-exclamation-circle me-2"></i>
                    <span th:text="${errorMessage}">Error message</span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>

                <!-- Edit Provider Form -->
                <div class="form-container">
                    <form id="editProviderForm" method="post" th:action="@{/staff/supplier/edit/{id}(id=${supplier.id})}" class="provider-form">
                        <div class="form-group">
                            <label for="supplierName" class="required">
                                <i class="fas fa-tag me-1"></i>
                                <span th:text="#{staff.providers.form.name}">Provider Name</span>
                            </label>
                            <input type="text" id="supplierName" name="supplierName" maxlength="100" 
                                   th:value="${supplier.supplierName}" 
                                   th:placeholder="#{staff.providers.form.name.placeholder}" required>
                            <div class="error-message" id="supplierNameError" th:text="#{staff.providers.form.name.error}">Provider name is required (max 100 characters)</div>
                        </div>

                        <div class="form-group">
                            <label for="supplierCategoryId" class="required">
                                <i class="fas fa-list me-1"></i>
                                <span th:text="#{staff.providers.form.category}">Provider Category</span>
                            </label>
                            <select id="supplierCategoryId" name="supplierCategoryId" required>
                                <option value="" th:text="#{staff.providers.form.category.select}">-- Select Category --</option>
                                <option th:each="category : ${categories}" 
                                        th:value="${category.id}" 
                                        th:text="${category.name}"
                                        th:selected="${category.id == supplier.supplierCategory.id}">Category</option>
                            </select>
                            <div class="error-message" id="supplierCategoryIdError" th:text="#{staff.providers.form.category.error}">Provider category is required</div>
                        </div>

                        <div class="form-group">
                            <label for="phoneNumber">
                                <i class="fas fa-phone me-1"></i>
                                <span th:text="#{staff.providers.form.phone}">Phone Number</span>
                            </label>
                            <input type="text" id="phoneNumber" name="phoneNumber" maxlength="20"
                                   th:value="${supplier.phoneNumber}"
                                   th:placeholder="#{staff.providers.form.phone.placeholder}">
                            <div class="error-message" id="phoneNumberError" th:text="#{staff.providers.form.phone.error}">Phone number must be max 20 characters</div>
                        </div>

                        <div class="form-group">
                            <label for="email">
                                <i class="fas fa-envelope me-1"></i>
                                <span th:text="#{staff.providers.form.email}">Email</span>
                            </label>
                            <input type="email" id="email" name="email" maxlength="100"
                                   th:value="${supplier.email}"
                                   th:placeholder="#{staff.providers.form.email.placeholder}">
                            <div class="error-message" id="emailError" th:text="#{staff.providers.form.email.error}">Email must be valid and max 100 characters</div>
                        </div>

                        <div class="form-group">
                            <label for="note">
                                <i class="fas fa-align-left me-1"></i>
                                <span th:text="#{staff.providers.form.note}">Note</span>
                            </label>
                            <textarea id="note" name="note" rows="4"
                                      th:placeholder="#{staff.providers.form.note.placeholder}" th:text="${supplier.note}"></textarea>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" th:onclick="'window.location.href=\'' + @{/staff/supplier/list} + '\''">
                                <i class="fas fa-times me-2"></i>
                                <span th:text="#{btn.cancel}">Cancel</span>
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>
                                <span th:text="#{btn.update}">Update</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Staff Scripts Fragment -->
    <div th:replace="fragments/staff-sidebar :: staff-scripts"></div>
    
    <script>
        document.getElementById('editProviderForm').addEventListener('submit', function(event) {
            let isValid = true;

            // Validate provider name
            const supplierName = document.getElementById('supplierName');
            const supplierNameError = document.getElementById('supplierNameError');
            if (!supplierName.value.trim() || supplierName.value.length > 100) {
                supplierName.classList.add('invalid');
                supplierNameError.style.display = 'block';
                isValid = false;
            } else {
                supplierName.classList.remove('invalid');
                supplierNameError.style.display = 'none';
            }

            // Validate provider category
            const supplierCategoryId = document.getElementById('supplierCategoryId');
            const supplierCategoryIdError = document.getElementById('supplierCategoryIdError');
            if (!supplierCategoryId.value) {
                supplierCategoryId.classList.add('invalid');
                supplierCategoryIdError.style.display = 'block';
                isValid = false;
            } else {
                supplierCategoryId.classList.remove('invalid');
                supplierCategoryIdError.style.display = 'none';
            }

            // Validate phone number (optional but max 20 chars)
            const phoneNumber = document.getElementById('phoneNumber');
            const phoneNumberError = document.getElementById('phoneNumberError');
            if (phoneNumber.value && phoneNumber.value.length > 20) {
                phoneNumber.classList.add('invalid');
                phoneNumberError.style.display = 'block';
                isValid = false;
            } else {
                phoneNumber.classList.remove('invalid');
                phoneNumberError.style.display = 'none';
            }

            // Validate email (optional but must be valid and max 100 chars)
            const email = document.getElementById('email');
            const emailError = document.getElementById('emailError');
            if (email.value) {
                const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailPattern.test(email.value) || email.value.length > 100) {
                    email.classList.add('invalid');
                    emailError.style.display = 'block';
                    isValid = false;
                } else {
                    email.classList.remove('invalid');
                    emailError.style.display = 'none';
                }
            }

            if (!isValid) {
                event.preventDefault();
                alert(/*[[#{form.validation.error}]]*/ 'Please correct the errors in the form before submitting.');
            }
        });

        // Real-time validation on input
        document.getElementById('supplierName').addEventListener('input', function() {
            const error = document.getElementById('supplierNameError');
            if (this.value.trim() && this.value.length <= 100) {
                this.classList.remove('invalid');
                error.style.display = 'none';
            }
        });

        document.getElementById('supplierCategoryId').addEventListener('change', function() {
            const error = document.getElementById('supplierCategoryIdError');
            if (this.value) {
                this.classList.remove('invalid');
                error.style.display = 'none';
            }
        });

        document.getElementById('phoneNumber').addEventListener('input', function() {
            const error = document.getElementById('phoneNumberError');
            if (!this.value || this.value.length <= 20) {
                this.classList.remove('invalid');
                error.style.display = 'none';
            }
        });

        document.getElementById('email').addEventListener('input', function() {
            const error = document.getElementById('emailError');
            if (!this.value || (this.value.length <= 100 && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.value))) {
                this.classList.remove('invalid');
                error.style.display = 'none';
            }
        });
    </script>
</body>
</html>
