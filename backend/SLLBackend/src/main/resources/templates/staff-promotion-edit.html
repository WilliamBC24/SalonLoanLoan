<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Edit Promotion</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            max-width: 800px;
        }
        h1 {
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        input[type="text"],
        input[type="number"],
        input[type="datetime-local"],
        select,
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        .invalid {
            border-color: #dc3545 !important;
        }
        .error-message {
            color: #dc3545;
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }
        .buttons {
            margin-top: 20px;
        }
        button {
            padding: 10px 20px;
            margin-right: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .submit-btn {
            background: #007bff;
            color: white;
        }
        .submit-btn:hover {
            background: #0056b3;
        }
        .cancel-btn {
            background: #6c757d;
            color: white;
        }
        .cancel-btn:hover {
            background: #545b62;
        }
    </style>
</head>
<body>
    <h1>Edit Promotion</h1>
    
    <form id="promotionForm" method="post" th:action="@{/staff/promotion/edit/{id}(id=${promotion.id})}">
        <div class="form-group">
            <label for="promotionName">Promotion Name: <span style="color: red;">*</span></label>
            <input type="text" id="promotionName" name="promotionName" 
                   th:value="${promotion.promotionName}" required />
            <div id="promotionNameError" class="error-message">Promotion name is required</div>
        </div>

        <div class="form-group">
            <label for="promotionDescription">Description:</label>
            <textarea id="promotionDescription" name="promotionDescription" 
                      th:text="${promotion.promotionDescription}"></textarea>
        </div>

        <div class="form-group">
            <label for="discountType">Discount Type: <span style="color: red;">*</span></label>
            <select id="discountType" name="discountType" required>
                <option value="">Select discount type</option>
                <option value="AMOUNT" th:selected="${promotion.discountType.toString() == 'AMOUNT'}">Amount (VND)</option>
                <option value="PERCENTAGE" th:selected="${promotion.discountType.toString() == 'PERCENTAGE'}">Percentage (%)</option>
            </select>
            <div id="discountTypeError" class="error-message">Please select a discount type</div>
        </div>

        <div class="form-group">
            <label for="discountAmount">Discount Amount: <span style="color: red;">*</span></label>
            <input type="number" id="discountAmount" name="discountAmount" 
                   th:value="${promotion.discountAmount}" min="1" required />
            <div id="discountAmountError" class="error-message">Discount amount must be at least 1</div>
        </div>

        <div class="form-group">
            <label for="effectiveFrom">Effective From: <span style="color: red;">*</span></label>
            <input type="datetime-local" id="effectiveFrom" name="effectiveFrom" 
                   th:value="${#temporals.format(promotion.effectiveFrom, 'yyyy-MM-dd\'T\'HH:mm')}" required />
            <div id="effectiveFromError" class="error-message">Effective from date is required</div>
        </div>

        <div class="form-group">
            <label for="effectiveTo">Effective To: <span style="color: red;">*</span></label>
            <input type="datetime-local" id="effectiveTo" name="effectiveTo" 
                   th:value="${#temporals.format(promotion.effectiveTo, 'yyyy-MM-dd\'T\'HH:mm')}" required />
            <div id="effectiveToError" class="error-message">Effective to date is required and must be after effective from date</div>
        </div>

        <div class="form-group">
            <label for="promotionStatusId">Status: <span style="color: red;">*</span></label>
            <select id="promotionStatusId" name="promotionStatusId" required>
                <option value="">Select status</option>
                <option th:each="status : ${statuses}" 
                        th:value="${status.id}" 
                        th:text="${status.name}"
                        th:selected="${promotion.promotionStatus != null and promotion.promotionStatus.id == status.id}">
                    Status
                </option>
            </select>
            <div id="promotionStatusIdError" class="error-message">Please select a status</div>
        </div>

        <div class="buttons">
            <button type="submit" class="submit-btn">Update Promotion</button>
            <button type="button" class="cancel-btn" onclick="window.location.href='/staff/promotion/list'">Cancel</button>
        </div>
    </form>

    <script>
        document.getElementById('promotionForm').addEventListener('submit', function(event) {
            let isValid = true;

            // Validate promotion name
            const promotionName = document.getElementById('promotionName');
            const promotionNameError = document.getElementById('promotionNameError');
            if (!promotionName.value.trim()) {
                promotionName.classList.add('invalid');
                promotionNameError.style.display = 'block';
                isValid = false;
            } else {
                promotionName.classList.remove('invalid');
                promotionNameError.style.display = 'none';
            }

            // Validate discount type
            const discountType = document.getElementById('discountType');
            const discountTypeError = document.getElementById('discountTypeError');
            if (!discountType.value) {
                discountType.classList.add('invalid');
                discountTypeError.style.display = 'block';
                isValid = false;
            } else {
                discountType.classList.remove('invalid');
                discountTypeError.style.display = 'none';
            }

            // Validate discount amount
            const discountAmount = document.getElementById('discountAmount');
            const discountAmountError = document.getElementById('discountAmountError');
            if (!discountAmount.value || parseInt(discountAmount.value) < 1) {
                discountAmount.classList.add('invalid');
                discountAmountError.style.display = 'block';
                isValid = false;
            } else {
                discountAmount.classList.remove('invalid');
                discountAmountError.style.display = 'none';
            }

            // Validate effective from
            const effectiveFrom = document.getElementById('effectiveFrom');
            const effectiveFromError = document.getElementById('effectiveFromError');
            if (!effectiveFrom.value) {
                effectiveFrom.classList.add('invalid');
                effectiveFromError.style.display = 'block';
                isValid = false;
            } else {
                effectiveFrom.classList.remove('invalid');
                effectiveFromError.style.display = 'none';
            }

            // Validate effective to
            const effectiveTo = document.getElementById('effectiveTo');
            const effectiveToError = document.getElementById('effectiveToError');
            if (!effectiveTo.value) {
                effectiveTo.classList.add('invalid');
                effectiveToError.style.display = 'block';
                isValid = false;
            } else if (effectiveFrom.value && new Date(effectiveTo.value) <= new Date(effectiveFrom.value)) {
                effectiveTo.classList.add('invalid');
                effectiveToError.style.display = 'block';
                isValid = false;
            } else {
                effectiveTo.classList.remove('invalid');
                effectiveToError.style.display = 'none';
            }

            // Validate status
            const promotionStatusId = document.getElementById('promotionStatusId');
            const promotionStatusIdError = document.getElementById('promotionStatusIdError');
            if (!promotionStatusId.value) {
                promotionStatusId.classList.add('invalid');
                promotionStatusIdError.style.display = 'block';
                isValid = false;
            } else {
                promotionStatusId.classList.remove('invalid');
                promotionStatusIdError.style.display = 'none';
            }

            if (!isValid) {
                event.preventDefault();
            }
        });

        // Real-time validation on input
        document.getElementById('promotionName').addEventListener('input', function() {
            if (this.value.trim()) {
                this.classList.remove('invalid');
                document.getElementById('promotionNameError').style.display = 'none';
            }
        });

        document.getElementById('discountType').addEventListener('change', function() {
            if (this.value) {
                this.classList.remove('invalid');
                document.getElementById('discountTypeError').style.display = 'none';
            }
        });

        document.getElementById('discountAmount').addEventListener('input', function() {
            if (this.value && parseInt(this.value) >= 1) {
                this.classList.remove('invalid');
                document.getElementById('discountAmountError').style.display = 'none';
            }
        });

        document.getElementById('effectiveFrom').addEventListener('change', function() {
            if (this.value) {
                this.classList.remove('invalid');
                document.getElementById('effectiveFromError').style.display = 'none';
            }
        });

        document.getElementById('effectiveTo').addEventListener('change', function() {
            const effectiveFrom = document.getElementById('effectiveFrom').value;
            if (this.value && (!effectiveFrom || new Date(this.value) > new Date(effectiveFrom))) {
                this.classList.remove('invalid');
                document.getElementById('effectiveToError').style.display = 'none';
            }
        });

        document.getElementById('promotionStatusId').addEventListener('change', function() {
            if (this.value) {
                this.classList.remove('invalid');
                document.getElementById('promotionStatusIdError').style.display = 'none';
            }
        });
    </script>
</body>
</html>
