<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Staff - Edit Voucher</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            max-width: 800px;
        }
        h1 {
            color: #333;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        .form-group .error {
            color: #dc3545;
            font-size: 0.875em;
            margin-top: 5px;
            display: none;
        }
        .form-group input.invalid,
        .form-group select.invalid,
        .form-group textarea.invalid {
            border-color: #dc3545;
        }
        .form-group input:disabled {
            background-color: #e9ecef;
            cursor: not-allowed;
        }
        .button-group {
            margin-top: 30px;
            display: flex;
            gap: 10px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        .btn-primary {
            background: #007bff;
            color: white;
        }
        .btn-primary:hover {
            background: #0056b3;
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #545b62;
        }
        .alert {
            padding: 12px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .required::after {
            content: " *";
            color: #dc3545;
        }
    </style>
</head>
<body>
    <h1>Edit Voucher</h1>

    <!-- Error Messages -->
    <div th:if="${errorMessage}" class="alert alert-error" th:text="${errorMessage}"></div>

    <form id="voucherForm" method="post" th:action="@{/staff/voucher/edit/{id}(id=${voucher.id})}">
        <div class="form-group">
            <label for="voucherName" class="required">Voucher Name</label>
            <input type="text" id="voucherName" name="voucherName" th:value="${voucher.voucherName}" required>
            <div class="error" id="voucherNameError">Voucher name is required.</div>
        </div>

        <div class="form-group">
            <label for="voucherDescription" class="required">Voucher Description</label>
            <textarea id="voucherDescription" name="voucherDescription" required th:text="${voucher.voucherDescription}"></textarea>
            <div class="error" id="voucherDescriptionError">Voucher description is required.</div>
        </div>

        <div class="form-group">
            <label for="voucherCode" class="required">Voucher Code</label>
            <input type="text" id="voucherCode" name="voucherCode" th:value="${voucher.voucherCode}" required>
            <div class="error" id="voucherCodeError">Voucher code is required.</div>
        </div>

        <div class="form-group">
            <label for="discountType" class="required">Discount Type</label>
            <select id="discountType" name="discountType" required>
                <option value="">Select Discount Type</option>
                <option value="AMOUNT" th:selected="${voucher.discountType.toString() == 'AMOUNT'}">Amount</option>
                <option value="PERCENTAGE" th:selected="${voucher.discountType.toString() == 'PERCENTAGE'}">Percentage</option>
            </select>
            <div class="error" id="discountTypeError">Please select a discount type.</div>
        </div>

        <div class="form-group">
            <label for="discountAmount" class="required">Discount Amount</label>
            <input type="number" id="discountAmount" name="discountAmount" th:value="${voucher.discountAmount}" min="1" required>
            <div class="error" id="discountAmountError">Discount amount must be greater than 0.</div>
        </div>

        <div class="form-group">
            <label for="effectiveFrom" class="required">Effective From</label>
            <input type="datetime-local" id="effectiveFrom" name="effectiveFrom" 
                   th:value="${#temporals.format(voucher.effectiveFrom, 'yyyy-MM-dd' + 'T' + 'HH:mm')}" required>
            <div class="error" id="effectiveFromError">Effective from date is required.</div>
        </div>

        <div class="form-group">
            <label for="effectiveTo" class="required">Effective To</label>
            <input type="datetime-local" id="effectiveTo" name="effectiveTo" 
                   th:value="${#temporals.format(voucher.effectiveTo, 'yyyy-MM-dd' + 'T' + 'HH:mm')}" required>
            <div class="error" id="effectiveToError">Effective to date is required and must be after effective from date.</div>
        </div>

        <div class="form-group">
            <label for="maxUsage" class="required">Max Usage</label>
            <input type="number" id="maxUsage" name="maxUsage" th:value="${voucher.maxUsage}" min="1" required>
            <div class="error" id="maxUsageError">Max usage must be greater than 0.</div>
        </div>

        <div class="form-group">
            <label>Used Count</label>
            <input type="number" th:value="${voucher.usedCount}" disabled>
        </div>

        <div class="form-group">
            <label for="voucherStatusId" class="required">Voucher Status</label>
            <select id="voucherStatusId" name="voucherStatusId" required>
                <option value="">Select Status</option>
                <option th:each="status : ${statuses}" 
                        th:value="${status.id}" 
                        th:text="${status.name}"
                        th:selected="${voucher.voucherStatus.id == status.id}">
                    Status
                </option>
            </select>
            <div class="error" id="voucherStatusIdError">Please select a voucher status.</div>
        </div>

        <div class="button-group">
            <button type="submit" class="btn btn-primary">Update Voucher</button>
            <button type="button" class="btn btn-secondary" onclick="window.location.href='/staff/voucher/list'">Cancel</button>
        </div>
    </form>

    <script>
        document.getElementById('voucherForm').addEventListener('submit', function(event) {
            let isValid = true;

            // Validate voucher name
            const voucherName = document.getElementById('voucherName');
            const voucherNameError = document.getElementById('voucherNameError');
            if (!voucherName.value.trim()) {
                voucherName.classList.add('invalid');
                voucherNameError.style.display = 'block';
                isValid = false;
            } else {
                voucherName.classList.remove('invalid');
                voucherNameError.style.display = 'none';
            }

            // Validate voucher description
            const voucherDescription = document.getElementById('voucherDescription');
            const voucherDescriptionError = document.getElementById('voucherDescriptionError');
            if (!voucherDescription.value.trim()) {
                voucherDescription.classList.add('invalid');
                voucherDescriptionError.style.display = 'block';
                isValid = false;
            } else {
                voucherDescription.classList.remove('invalid');
                voucherDescriptionError.style.display = 'none';
            }

            // Validate voucher code
            const voucherCode = document.getElementById('voucherCode');
            const voucherCodeError = document.getElementById('voucherCodeError');
            if (!voucherCode.value.trim()) {
                voucherCode.classList.add('invalid');
                voucherCodeError.style.display = 'block';
                isValid = false;
            } else {
                voucherCode.classList.remove('invalid');
                voucherCodeError.style.display = 'none';
            }

            // Validate discount type
            const discountType = document.getElementById('discountType');
            const discountTypeError = document.getElementById('discountTypeError');
            if (!discountType.value) {
                discountType.classList.add('invalid');
                discountTypeError.style.display = 'block';
                isValid = false;
            } else {
                discountType.classList.remove('invalid');
                discountTypeError.style.display = 'none';
            }

            // Validate discount amount
            const discountAmount = document.getElementById('discountAmount');
            const discountAmountError = document.getElementById('discountAmountError');
            if (!discountAmount.value || parseInt(discountAmount.value) < 1) {
                discountAmount.classList.add('invalid');
                discountAmountError.style.display = 'block';
                isValid = false;
            } else {
                discountAmount.classList.remove('invalid');
                discountAmountError.style.display = 'none';
            }

            // Validate effective from
            const effectiveFrom = document.getElementById('effectiveFrom');
            const effectiveFromError = document.getElementById('effectiveFromError');
            if (!effectiveFrom.value) {
                effectiveFrom.classList.add('invalid');
                effectiveFromError.style.display = 'block';
                isValid = false;
            } else {
                effectiveFrom.classList.remove('invalid');
                effectiveFromError.style.display = 'none';
            }

            // Validate effective to
            const effectiveTo = document.getElementById('effectiveTo');
            const effectiveToError = document.getElementById('effectiveToError');
            if (!effectiveTo.value) {
                effectiveTo.classList.add('invalid');
                effectiveToError.style.display = 'block';
                isValid = false;
            } else if (effectiveFrom.value && effectiveTo.value && new Date(effectiveTo.value) <= new Date(effectiveFrom.value)) {
                effectiveTo.classList.add('invalid');
                effectiveToError.style.display = 'block';
                isValid = false;
            } else {
                effectiveTo.classList.remove('invalid');
                effectiveToError.style.display = 'none';
            }

            // Validate max usage
            const maxUsage = document.getElementById('maxUsage');
            const maxUsageError = document.getElementById('maxUsageError');
            if (!maxUsage.value || parseInt(maxUsage.value) < 1) {
                maxUsage.classList.add('invalid');
                maxUsageError.style.display = 'block';
                isValid = false;
            } else {
                maxUsage.classList.remove('invalid');
                maxUsageError.style.display = 'none';
            }

            // Validate voucher status
            const voucherStatusId = document.getElementById('voucherStatusId');
            const voucherStatusIdError = document.getElementById('voucherStatusIdError');
            if (!voucherStatusId.value) {
                voucherStatusId.classList.add('invalid');
                voucherStatusIdError.style.display = 'block';
                isValid = false;
            } else {
                voucherStatusId.classList.remove('invalid');
                voucherStatusIdError.style.display = 'none';
            }

            if (!isValid) {
                event.preventDefault();
                alert('Please correct the errors in the form before submitting.');
            }
        });

        // Real-time validation on input
        document.getElementById('voucherName').addEventListener('input', function() {
            if (this.value.trim()) {
                this.classList.remove('invalid');
                document.getElementById('voucherNameError').style.display = 'none';
            }
        });

        document.getElementById('voucherDescription').addEventListener('input', function() {
            if (this.value.trim()) {
                this.classList.remove('invalid');
                document.getElementById('voucherDescriptionError').style.display = 'none';
            }
        });

        document.getElementById('voucherCode').addEventListener('input', function() {
            if (this.value.trim()) {
                this.classList.remove('invalid');
                document.getElementById('voucherCodeError').style.display = 'none';
            }
        });

        document.getElementById('discountType').addEventListener('change', function() {
            if (this.value) {
                this.classList.remove('invalid');
                document.getElementById('discountTypeError').style.display = 'none';
            }
        });

        document.getElementById('discountAmount').addEventListener('input', function() {
            if (this.value && parseInt(this.value) >= 1) {
                this.classList.remove('invalid');
                document.getElementById('discountAmountError').style.display = 'none';
            }
        });

        document.getElementById('effectiveFrom').addEventListener('change', function() {
            if (this.value) {
                this.classList.remove('invalid');
                document.getElementById('effectiveFromError').style.display = 'none';
            }
        });

        document.getElementById('effectiveTo').addEventListener('change', function() {
            const effectiveFrom = document.getElementById('effectiveFrom').value;
            if (this.value && (!effectiveFrom || new Date(this.value) > new Date(effectiveFrom))) {
                this.classList.remove('invalid');
                document.getElementById('effectiveToError').style.display = 'none';
            }
        });

        document.getElementById('maxUsage').addEventListener('input', function() {
            if (this.value && parseInt(this.value) >= 1) {
                this.classList.remove('invalid');
                document.getElementById('maxUsageError').style.display = 'none';
            }
        });

        document.getElementById('voucherStatusId').addEventListener('change', function() {
            if (this.value) {
                this.classList.remove('invalid');
                document.getElementById('voucherStatusIdError').style.display = 'none';
            }
        });
    </script>
</body>
</html>
